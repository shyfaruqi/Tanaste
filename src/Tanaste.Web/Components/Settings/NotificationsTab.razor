@namespace Tanaste.Web.Components.Settings

@* Notification preferences — toggle which notification categories are active. *@

<MudPaper Elevation="0" Style="@GlassStyle">

    <MudStack Row="true" AlignItems="AlignItems.Center" Class="mb-2">
        <MudIcon Icon="@Icons.Material.Outlined.Notifications" Color="Color.Primary" Class="mr-2" />
        <MudText Typo="Typo.h6">Notification Preferences</MudText>
    </MudStack>
    <MudText Typo="Typo.body2" Color="Color.Secondary" Class="mb-6">
        Choose which events generate notifications. Disabled categories are silently
        logged in the Activity tab but will not trigger alerts.
    </MudText>

    @foreach (var cat in _categories)
    {
        <MudPaper Elevation="0" Style="@InnerCardStyle" Class="mb-3">
            <MudStack Row="true" AlignItems="AlignItems.Center" Spacing="3">
                <MudIcon Icon="@cat.Icon" Color="Color.Secondary" />
                <MudStack Spacing="0" Style="flex: 1; min-width: 0;">
                    <MudText Typo="Typo.subtitle2">@cat.Label</MudText>
                    <MudText Typo="Typo.caption" Color="Color.Secondary">
                        @cat.Description
                    </MudText>
                </MudStack>
                <MudSwitch T="bool"
                           Value="@cat.Enabled"
                           ValueChanged="@(v => ToggleCategory(cat, v))"
                           Color="Color.Primary" />
            </MudStack>
        </MudPaper>
    }

    <MudAlert Severity="Severity.Info" Class="mt-4" Variant="Variant.Outlined">
        <MudText Typo="Typo.caption">
            Notification preferences are stored locally in your browser for this session.
            A future update will persist them to the Engine.
        </MudText>
    </MudAlert>

</MudPaper>

@code {

    private const string GlassStyle =
        "background: var(--tanaste-glass-bg); " +
        "border: 1px solid var(--tanaste-glass-border); " +
        "backdrop-filter: blur(10px); " +
        "-webkit-backdrop-filter: blur(10px); " +
        "border-radius: 24px; " +
        "padding: 32px;";

    private const string InnerCardStyle =
        "background: var(--tanaste-glass-inner-bg); " +
        "border: 1px solid var(--tanaste-glass-inner-border); " +
        "border-radius: 16px; " +
        "padding: 16px 20px;";

    // ── State ────────────────────────────────────────────────────────────────────

    private List<NotificationCategory> _categories = [];

    // ── Lifecycle ────────────────────────────────────────────────────────────────

    protected override void OnInitialized()
    {
        _categories =
        [
            new NotificationCategory
            {
                Id          = "media_added",
                Label       = "New Media Added",
                Description = "A new book, audiobook, video, or comic has been ingested into the library.",
                Icon        = Icons.Material.Filled.LibraryAdd,
                Enabled     = true,
            },
            new NotificationCategory
            {
                Id          = "metadata_updated",
                Label       = "Metadata Updated",
                Description = "An external provider enriched a file with new cover art, descriptions, or credits.",
                Icon        = Icons.Material.Filled.AutoAwesome,
                Enabled     = true,
            },
            new NotificationCategory
            {
                Id          = "person_enriched",
                Label       = "Person Enriched",
                Description = "An author or narrator has been enriched with a portrait and biography from Wikidata.",
                Icon        = Icons.Material.Filled.Person,
                Enabled     = true,
            },
            new NotificationCategory
            {
                Id          = "server_status",
                Label       = "Server Start / Stop",
                Description = "The Engine has started, stopped, or the Dashboard connection status has changed.",
                Icon        = Icons.Material.Filled.PowerSettingsNew,
                Enabled     = true,
            },
            new NotificationCategory
            {
                Id          = "ingestion_progress",
                Label       = "Ingestion Progress",
                Description = "Scanning, hashing, or processing updates during an active ingestion run.",
                Icon        = Icons.Material.Filled.Sync,
                Enabled     = false,
            },
            new NotificationCategory
            {
                Id          = "errors",
                Label       = "Errors & Warnings",
                Description = "Something went wrong — a file could not be processed, a provider was unreachable, etc.",
                Icon        = Icons.Material.Filled.ErrorOutline,
                Enabled     = true,
            },
        ];
    }

    // ── Handlers ─────────────────────────────────────────────────────────────────

    private void ToggleCategory(NotificationCategory cat, bool enabled)
    {
        cat.Enabled = enabled;
    }

    // ── Models ───────────────────────────────────────────────────────────────────

    private sealed class NotificationCategory
    {
        public string Id          { get; init; } = "";
        public string Label       { get; init; } = "";
        public string Description { get; init; } = "";
        public string Icon        { get; init; } = Icons.Material.Filled.Notifications;
        public bool   Enabled     { get; set; }
    }
}
